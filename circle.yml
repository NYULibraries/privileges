machine:
  environment:
    SOLR_URL: 'http://localhost:8984/solr/test'
    LOGIN_URL: 'https://dev.login.library.nyu.edu'
    SSO_LOGOUT_PATH: /logout
dependencies:
  pre:
    - gem update bundler
    - bundle config github.https true
  post:
    - mysql -e 'create database privileges_test;'
    - RAILS_ENV=test bundle exec rake db:schema:load
    - bundle exec sunspot-solr start -p 8984
    - sleep 10
test:
  override:
    - RAILS_ENV=test bundle exec rspec --color --format progress
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - RAILS_ENV=test bundle exec cucumber --format pretty --format json --out $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
    - RAILS_ENV=test bundle exec rake test
  post:
    - bundle exec rake coveralls:push
